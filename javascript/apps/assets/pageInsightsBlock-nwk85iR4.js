const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./i18n-Cv2B2p7e.js","./preload-helper-PPVm8Dsz.js","./page_mf_2_insights__loadShare__react__loadShare__-BtZvGOZQ.js","./_commonjsHelpers-CqkleIqs.js","./page_mf_2_insights__mf_v__runtimeInit__mf_v__-CsGJ69y1.js"])))=>i.map(i=>d[i]);
import{_ as ge}from"./preload-helper-PPVm8Dsz.js";import{p as l}from"./page_mf_2_insights__loadShare__react__loadShare__-BtZvGOZQ.js";import{p as ie}from"./page_mf_2_insights__mf_v__runtimeInit__mf_v__-CsGJ69y1.js";var ce={exports:{}},Q={};var me=l,ye=Symbol.for("react.element"),_e=Symbol.for("react.fragment"),be=Object.prototype.hasOwnProperty,xe=me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ve={key:!0,ref:!0,__self:!0,__source:!0};function le(e,t,n){var r,o={},s=null,y=null;n!==void 0&&(s=""+n),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(y=t.ref);for(r in t)be.call(t,r)&&!ve.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:ye,type:e,key:s,ref:y,props:o,_owner:xe.current}}Q.Fragment=_e;Q.jsx=le;Q.jsxs=le;ce.exports=Q;var a=ce.exports;const{initPromise:Se}=ie,we=Se.then(e=>e.loadShare("react-redux",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"^9.2.0"}}})),je=await we.then(e=>e());var re=je;const Ce=(e,t,n,r)=>{const o=[n,{code:t,...r||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(o,"warn","react-i18next::",!0);D(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...o):console?.warn&&console.warn(...o)},se={},ue=(e,t,n,r)=>{D(n)&&se[n]||(D(n)&&(se[n]=new Date),Ce(e,t,n,r))},de=(e,t)=>()=>{if(e.isInitialized)t();else{const n=()=>{setTimeout(()=>{e.off("initialized",n)},0),t()};e.on("initialized",n)}},X=(e,t,n)=>{e.loadNamespaces(t,de(e,n))},ae=(e,t,n,r)=>{if(D(n)&&(n=[n]),e.options.preload&&e.options.preload.indexOf(t)>-1)return X(e,n,r);n.forEach(o=>{e.options.ns.indexOf(o)<0&&e.options.ns.push(o)}),e.loadLanguages(t,de(e,r))},Ne=(e,t,n={})=>!t.languages||!t.languages.length?(ue(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:n.lng,precheck:(r,o)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!o(r.isLanguageChangingTo,e))return!1}}),D=e=>typeof e=="string",Ee=e=>typeof e=="object"&&e!==null,Re=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Le={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},Ie=e=>Le[e],Te=e=>e.replace(Re,Ie);let ee={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Te,transDefaultProps:void 0};const Dt=(e={})=>{ee={...ee,...e}},ke=()=>ee;let pe;const Bt=e=>{pe=e},Oe=()=>pe,Me=l.createContext();class Ve{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var he={exports:{}},fe={};var A=l;function Pe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var qe=typeof Object.is=="function"?Object.is:Pe,$e=A.useState,Ue=A.useEffect,De=A.useLayoutEffect,Be=A.useDebugValue;function Ae(e,t){var n=t(),r=$e({inst:{value:n,getSnapshot:t}}),o=r[0].inst,s=r[1];return De(function(){o.value=n,o.getSnapshot=t,Z(o)&&s({inst:o})},[e,n,t]),Ue(function(){return Z(o)&&s({inst:o}),e(function(){Z(o)&&s({inst:o})})},[e]),Be(n),n}function Z(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!qe(e,n)}catch{return!0}}function ze(e,t){return t()}var Fe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ze:Ae;fe.useSyncExternalStore=A.useSyncExternalStore!==void 0?A.useSyncExternalStore:Fe;he.exports=fe;var Je=he.exports;const We=(e,t)=>D(t)?t:Ee(t)&&D(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,He={t:We,ready:!1},Ge=()=>()=>{},Qe=(e,t={})=>{const{i18n:n}=t,{i18n:r,defaultNS:o}=l.useContext(Me)||{},s=n||r||Oe();s&&!s.reportNamespaces&&(s.reportNamespaces=new Ve),s||ue(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const y=l.useMemo(()=>({...ke(),...s?.options?.react,...t}),[s,t]),{useSuspense:f,keyPrefix:j}=y,m=e,x=D(m)?[m]:m,_=l.useMemo(()=>x,x);s?.reportNamespaces?.addUsedNamespaces?.(_);const v=l.useRef(0),V=l.useCallback(u=>{if(!s)return Ge;const{bindI18n:d,bindI18nStore:h}=y,g=()=>{v.current+=1,u()};return d&&s.on(d,g),h&&s.store.on(h,g),()=>{d&&d.split(" ").forEach(R=>s.off(R,g)),h&&h.split(" ").forEach(R=>s.store.off(R,g))}},[s,y]),I=l.useRef(),P=l.useCallback(()=>{if(!s)return He;const u=!!(s.isInitialized||s.initializedStoreOnce)&&_.every($=>Ne($,s,y)),d=t.lng||s.language,h=v.current,g=I.current;if(g&&g.ready===u&&g.lng===d&&g.keyPrefix===j&&g.revision===h)return g;const C={t:s.getFixedT(d,y.nsMode==="fallback"?_:_[0],j),ready:u,lng:d,keyPrefix:j,revision:h};return I.current=C,C},[s,_,j,y,t.lng]),[T,E]=l.useState(0),{t:S,ready:w}=Je.useSyncExternalStore(V,P,P);l.useEffect(()=>{if(s&&!w&&!f){const u=()=>E(d=>d+1);t.lng?ae(s,t.lng,_,u):X(s,_,u)}},[s,t.lng,_,w,f,T]);const k=s||{},b=l.useRef(null),N=l.useRef(),O=u=>{const d=Object.getOwnPropertyDescriptors(u);d.__original&&delete d.__original;const h=Object.create(Object.getPrototypeOf(u),d);if(!Object.prototype.hasOwnProperty.call(h,"__original"))try{Object.defineProperty(h,"__original",{value:u,writable:!1,enumerable:!1,configurable:!1})}catch{}return h},q=l.useMemo(()=>{const u=k,d=u?.language;let h=u;u&&(b.current&&b.current.__original===u?N.current!==d?(h=O(u),b.current=h,N.current=d):h=b.current:(h=O(u),b.current=h,N.current=d));const g=[S,h,w];return g.t=S,g.i18n=h,g.ready=w,g},[S,k,w,k.resolvedLanguage,k.language,k.languages]);if(s&&f&&!w)throw new Promise(u=>{const d=()=>u();t.lng?ae(s,t.lng,_,d):X(s,_,d)});return q},Ze=({size:e="default",className:t="",color:n,...r})=>{const o=Object.assign({},{size:e,className:t,...r}),s=n?" moonstone-icon_"+n:"";return o.className=t+" moonstone-icon moonstone-icon_"+e+s,a.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",...o,children:a.jsx("path",{d:"M5 9.2H8V19H5V9.2ZM10.6 5H13.4V19H10.6V5ZM16.2 13H19V19H16.2V13Z"})})},Ke=({size:e="default",className:t="",color:n,...r})=>{const o=Object.assign({},{size:e,className:t,...r}),s=n?" moonstone-icon_"+n:"";return o.className=t+" moonstone-icon moonstone-icon_"+e+s,a.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",...o,children:a.jsx("path",{d:"M12 6V9L16 5L12 1V4C7.58 4 4 7.58 4 12C4 13.57 4.46 15.03 5.24 16.26L6.7 14.8C6.25 13.97 6 13.01 6 12C6 8.69 8.69 6 12 6ZM18.76 7.74L17.3 9.2C17.74 10.04 18 10.99 18 12C18 15.31 15.31 18 12 18V15L8 19L12 23V20C16.42 20 20 16.42 20 12C20 10.43 19.54 8.97 18.76 7.74Z"})})},{initPromise:Ye}=ie,Xe=Ye.then(e=>e.loadShare("chart.js",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"^4.5.1"}}})),et=await Xe.then(e=>e());var M=et;const B=new Map,H=new Map,tt=8e3,nt=()=>typeof window>"u"?"":window.contextJsParameters?.config?.pageInsights?.unomiBaseUrl||window.location?.origin||"",rt=()=>typeof window>"u"?"":window.contextJsParameters?.siteKey||window.contextJsParameters?.site?.key||"",te=({pagePath:e,pageUuid:t,timeRangeKey:n})=>e?`pagePath:${e}:range:${n||"lastMonth"}`:t?`pageUuid:${t}:range:${n||"lastMonth"}`:"",st=e=>{switch(e){case"last6Months":return"now-180d";case"last3Months":return"now-90d";case"lastMonth":return"now-30d";case"lastWeek":return"now-7d";case"today":return"now-1d";default:return"now-30d"}},z=({baseUrl:e,siteKey:t,pagePath:n,timeRangeKey:r,endpointPath:o,includeTimeRange:s,optimizedQuery:y,bodyOverride:f})=>{if(!e)throw new Error("Unomi base URL is not configured");const j=e.replace(/\/$/,"");if(!t)throw new Error("Missing siteKey for Unomi proxy");const m=`${j}/modules/jexperience/proxy/${t}`,x=new URL(`${m}${o}`);return x.searchParams.set("optimizedQuery","true"),{url:x,options:{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(f||{condition:{type:"booleanCondition",parameterValues:{operator:"and",subConditions:[{type:"eventTypeCondition",parameterValues:{eventTypeId:"view"}},...s?[{type:"eventPropertyCondition",parameterValues:{propertyName:"timeStamp",comparisonOperator:"greaterThanOrEqualTo",propertyValueDateExpr:st(r)}}]:[],...n?[{type:"eventPropertyCondition",parameterValues:{propertyName:"target.properties.pageInfo.pagePath",comparisonOperator:"equals",propertyValue:n}}]:[]]}},...o==="/cxs/query/event/timeStamp"?{aggregate:{type:"date",parameters:{interval:"1d",format:"yyyy-MM-dd"}}}:o==="/cxs/query/event/sessionId"||o==="/cxs/query/event/profileId"?{aggregate:{type:"string"}}:{}})}}},at=(e,t)=>{const n=new AbortController,r=()=>{n.abort()};e&&(e.aborted?n.abort():e.addEventListener("abort",r,{once:!0}));const o=setTimeout(()=>n.abort(),t),s=()=>{clearTimeout(o),e&&e.removeEventListener("abort",r)};return{signal:n.signal,cleanup:s}},ot=({pagePath:e,pageUuid:t,timeRangeKey:n})=>{const r=te({pagePath:e,pageUuid:t,timeRangeKey:n});return r?B.get(r):void 0},it=async({pagePath:e,pageUuid:t,baseUrl:n=nt(),siteKey:r=rt(),timeRangeKey:o,timeoutMs:s=tt,signal:y})=>{const f=te({pagePath:e,pageUuid:t,timeRangeKey:o});if(!f)throw new Error("Missing pagePath/pageUuid for insights lookup");if(B.has(f))return B.get(f);if(H.has(f))return H.get(f);const j=(async()=>{const m=z({baseUrl:n,siteKey:r,pagePath:e,timeRangeKey:o,endpointPath:"/cxs/query/event/timeStamp",includeTimeRange:!0,optimizedQuery:!0}),x=z({baseUrl:n,siteKey:r,pagePath:e,timeRangeKey:o,endpointPath:"/cxs/query/event/count",includeTimeRange:!1,optimizedQuery:!0,bodyOverride:{type:"booleanCondition",parameterValues:{operator:"and",subConditions:[{type:"eventPropertyCondition",parameterValues:{propertyName:"target.properties.pageInfo.pagePath",comparisonOperator:"equals",propertyValue:e}}]}}}),_=z({baseUrl:n,siteKey:r,pagePath:e,timeRangeKey:o,endpointPath:"/cxs/query/event/target.properties.pageInfo.sameDomainReferrer",includeTimeRange:!0,optimizedQuery:!0}),v=z({baseUrl:n,siteKey:r,pagePath:e,timeRangeKey:o,endpointPath:"/cxs/query/event/sessionId",includeTimeRange:!0,optimizedQuery:!0}),V=z({baseUrl:n,siteKey:r,pagePath:e,timeRangeKey:o,endpointPath:"/cxs/query/event/profileId",includeTimeRange:!0,optimizedQuery:!0}),{signal:I,cleanup:P}=at(y,s);try{const[T,E,S,w,k]=await Promise.all([fetch(m.url.toString(),{...m.options,signal:I}),fetch(x.url.toString(),{...x.options,signal:I}),fetch(_.url.toString(),{..._.options,signal:I}),fetch(v.url.toString(),{...v.options,signal:I}),fetch(V.url.toString(),{...V.options,signal:I})]);if(!T.ok)throw new Error(`Unomi request failed (${T.status})`);if(!E.ok)throw new Error(`Unomi request failed (${E.status})`);if(!S.ok)throw new Error(`Unomi request failed (${S.status})`);if(!w.ok)throw new Error(`Unomi request failed (${w.status})`);if(!k.ok)throw new Error(`Unomi request failed (${k.status})`);const b=await T.json(),N=await E.json(),O=await S.json(),q=await w.json(),u=await k.json(),d=typeof N=="number"?N:typeof N?.count=="number"?N.count:typeof N?._all=="number"?N._all:0,h=typeof b?._filtered=="number"?b._filtered:0,g=typeof O?.false=="number"?O.false:0,R=Object.keys(q||{}).filter(i=>!i.startsWith("_")).length,C=Object.keys(u||{}).filter(i=>!i.startsWith("_")).length,$=new Map;Object.entries(b||{}).forEach(([i,p])=>{if(i.startsWith("_")||typeof p!="number")return;const L=i.slice(0,10);$.set(L,($.get(L)||0)+p)});const J=Array.from($.entries()).sort(([i],[p])=>i.localeCompare(p)).map(([i,p])=>({date:i,count:p})),W={summary:{allVisits:d,visitsInRange:h,directEntries:g,uniqueSessions:R,uniqueVisitors:C},timeSeries:J,raw:{timeStampData:b,allTimeData:N,directEntryData:O,sessionData:q,visitorData:u}};return b&&Object.keys(b).length>0&&B.set(f,W),W}finally{P(),H.delete(f)}})();return H.set(f,j),j},K=({pagePath:e,pageUuid:t,timeRangeKey:n}={})=>{if(!e&&!t){B.clear();return}const r=te({pagePath:e,pageUuid:t,timeRangeKey:n});r&&B.delete(r)},ct=async()=>{try{console.log("[Dashboard Config] Starting fetch...");const t=await fetch(window.location.origin+"/modules/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query GetDashboardConfig {
        jcr {
          nodeByPath(path: "/sites/systemsite/contents/kibana/page-dashboard") {
            dashboardURL: property(name: "kibana:dashboardURL") {
              value
            }
            searchSourceJSON: property(name: "kibana:searchSourceJSON") {
              value
            }
          }
        }
      }
    `}),credentials:"include"});if(console.log("[Dashboard Config] Response status:",t.status),!t.ok)throw new Error(`GraphQL request failed: ${t.status}`);const n=await t.json();console.log("[Dashboard Config] GraphQL result:",n);const r=n?.data?.jcr?.nodeByPath;if(!r)return console.warn("[Dashboard Config] No node found in response"),null;const o={dashboardURL:r.dashboardURL?.value||"",searchSourceJSON:r.searchSourceJSON?.value||""};return console.log("[Dashboard Config] Fetched config:",{dashboardURL:o.dashboardURL,searchSourceJSONLength:o.searchSourceJSON.length}),o}catch(e){return console.error("[Dashboard Config] Failed to fetch:",e),null}},oe=e=>{const t=String(e??"");return/^[A-Za-z0-9_\-./~]+$/.test(t)?t:`'${t.replace(/'/g,"''")}'`},lt=e=>{console.log("[Utils] Extracting dashboard path from:",e);const t=new URL(e),n=t.pathname+t.hash;return console.log("[Utils] Extracted path:",n),n},ut=e=>{try{console.log("[Utils] Parsing searchSourceJSON, length:",e.length);const r=JSON.parse(e).filter?.[0]?.meta?.index||"";return console.log("[Utils] Extracted index:",r),r}catch(t){return console.error("[Utils] Failed to parse searchSourceJSON:",t),""}},dt=e=>{console.log("[Utils] Building dashboard URL with config:",e);const{origin:t,dashboardPath:n,indexValue:r,siteKey:o,pagePath:s}=e,y=oe(o),f=oe(s),j=`${t}/modules/kibana-proxy`+n+`?embed=true&show-time-filter=true&_a=(filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'${r}',key:scope.keyword,negate:!f,params:(query:${y}),type:phrase),query:(match_phrase:(scope.keyword:${y}))),('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'${r}',key:target.properties.pageInfo.pagePath.keyword,negate:!f,params:(query:${f}),type:phrase),query:(match_phrase:(target.properties.pageInfo.pagePath.keyword:${f})))),query:(language:kuery,query:''))`;return console.log("[Utils] Built URL:",j),j},pt="_container_1a6nn_1",ht="_headerRow_1a6nn_13",ft="_headerSpacer_1a6nn_19",gt="_rangeSelect_1a6nn_23",mt="_actionButton_1a6nn_41",yt="_buttonIcon_1a6nn_64",_t="_refreshButton_1a6nn_70",bt="_dashboardButton_1a6nn_85",xt="_title_1a6nn_103",vt="_chevron_1a6nn_123",St="_chevronExpanded_1a6nn_133",wt="_body_1a6nn_137",jt="_stateText_1a6nn_143",Ct="_cardGrid_1a6nn_153",Nt="_card_1a6nn_153",Et="_cardLabel_1a6nn_184",Rt="_cardValue_1a6nn_191",Lt="_chart_1a6nn_197",It="_chartCanvas_1a6nn_208",Tt="_sectionTitle_1a6nn_228",kt="_retry_1a6nn_255",c={container:pt,headerRow:ht,headerSpacer:ft,rangeSelect:gt,actionButton:mt,buttonIcon:yt,refreshButton:_t,dashboardButton:bt,title:xt,chevron:vt,chevronExpanded:St,body:wt,stateText:jt,cardGrid:Ct,card:Nt,cardLabel:Et,cardValue:Rt,chart:Lt,chartCanvas:It,sectionTitle:Tt,retry:kt},Ot="page-insights";M.Chart.register(M.BarController,M.BarElement,M.LineController,M.LineElement,M.PointElement,M.CategoryScale,M.LinearScale,M.Tooltip);let Y=null;const Mt=async()=>(Y||(Y=(await ge(async()=>{const{default:e}=await import("./i18n-Cv2B2p7e.js");return{default:e}},__vite__mapDeps([0,1,2,3,4]),import.meta.url)).default),Y),Vt=e=>{if(!e||typeof e!="object")return null;const t=e.summary||e.metrics||e;return{allVisits:t.allVisits??null,visitsInRange:t.visitsInRange??null,directEntries:t.directEntries??null,uniqueSessions:t.uniqueSessions??null,uniqueVisitors:t.uniqueVisitors??null,lastActivity:t.lastActivity||t.lastSeen||t.lastEvent||null,topInterests:t.topInterests||t.interests||t.topTags||null}},F=e=>Array.isArray(e)?e.length?e.join(", "):"-":e==null||e===""?"-":String(e),G=(e,t)=>({last6Months:t("rangeLast6Months"),last3Months:t("rangeLast3Months"),lastMonth:t("rangeLastMonth"),lastWeek:t("rangeLastWeek"),today:t("rangeToday")})[e]||t("rangeLastMonth"),Pt=()=>{const[e,t]=l.useState(null),{t:n}=Qe(Ot,{i18n:e||void 0}),[r,o]=l.useState("lastMonth"),[s,y]=l.useState(!1),{path:f,language:j}=re.useSelector(i=>({path:i.jcontent?.path,language:i.language}),re.shallowEqual),m=f||"",x="",_=l.useMemo(()=>{if(!f)return"";const i=f.split("/").filter(Boolean);return i[0]==="sites"&&i[1]?i[1]:""},[f]),v=m||x;l.useEffect(()=>{Mt().then(t)},[]);const[V,I]=l.useState(null);l.useEffect(()=>{console.log("[PageInsights] Fetching dashboard config..."),ct().then(i=>{console.log("[PageInsights] Dashboard config loaded:",i),I(i)})},[]);const P=l.useMemo(()=>{if(console.log("[PageInsights] Computing dashboardUrl...",{siteKey:_,pagePath:m,hasDashboardConfig:!!V}),!_||!m||typeof window>"u")return console.log("[PageInsights] Missing required data for dashboard URL"),"";if(!V)return console.log("[PageInsights] Dashboard config not loaded yet"),"";const{dashboardURL:i,searchSourceJSON:p}=V;if(!i||!p)return console.warn("Dashboard config incomplete:",{dashboardURL:i,searchSourceJSON:p}),"";try{const L=lt(i),U=ut(p);U||console.warn("Could not extract index from searchSourceJSON");const ne=dt({origin:window.location.origin,dashboardPath:L,indexValue:U,siteKey:_,pagePath:m});return console.log("Built dashboard URL:",ne),ne}catch(L){return console.error("Failed to build dashboard URL:",L),""}},[_,m,V]),[T,E]=l.useState("idle"),[S,w]=l.useState(null),[k,b]=l.useState(null),[N,O]=l.useState(0),q=l.useRef(null),u=l.useRef(null),d=l.useMemo(()=>typeof window>"u"?"rgba(0, 0, 0, 0.15)":getComputedStyle(document.documentElement).getPropertyValue("--color-accent_light_plain60").trim()||"rgba(0, 0, 0, 0.15)",[]),h=l.useMemo(()=>typeof window>"u"?"rgba(0, 0, 0, 0.15)":getComputedStyle(document.documentElement).getPropertyValue("--color-accent_light_plain20").trim()||"rgba(0, 0, 0, 0.15)",[]),g=l.useMemo(()=>typeof window>"u"?"rgba(0, 0, 0, 0.9)":getComputedStyle(document.documentElement).getPropertyValue("--color-accent_dark_contrast").trim()||"rgba(0, 0, 0, 0.9)",[]);l.useEffect(()=>{E("idle"),w(null),b(null)},[v]),l.useEffect(()=>{if(!s||!v)return;const i=ot({pagePath:m,pageUuid:x,timeRangeKey:r});if(i){w(i),E("success");return}let p=!0;const L=new AbortController;return E("loading"),b(null),it({pagePath:m,pageUuid:x,siteKey:_,timeRangeKey:r,signal:L.signal}).then(U=>{p&&(w(U??null),E("success"))}).catch(U=>{!p||U?.name==="AbortError"||(b(U),E("error"))}),()=>{p=!1,L.abort()}},[s,v,m,x,N,r]);const R=l.useMemo(()=>Vt(S),[S]),C=l.useMemo(()=>Array.isArray(S?.timeSeries)?S.timeSeries:[],[S]),$=l.useMemo(()=>C.length?Math.max(...C.map(i=>i.count||0)):0,[C]),J=S&&Object.keys(S).length>0;l.useEffect(()=>{if(!s||!q.current||(u.current&&(u.current.destroy(),u.current=null),!C.length))return;const i=q.current.getContext("2d");if(i)return u.current=new M.Chart(i,{type:"bar",data:{labels:C.map(p=>p.date),datasets:[{label:n("viewsOverTime"),data:C.map(p=>p.count),backgroundColor:"rgba(74, 74, 74, 0.8)",borderRadius:4,maxBarThickness:18,order:2},{label:n("viewsOverTime"),type:"line",data:C.map(p=>p.count),borderColor:d,backgroundColor:d,borderWidth:2,pointRadius:2,pointHoverRadius:3,tension:.3,order:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:h,titleColor:g,bodyColor:g}},scales:{x:{grid:{display:!1},ticks:{maxRotation:0,autoSkip:!0,maxTicksLimit:6}},y:{grid:{color:"rgba(0, 0, 0, 0.08)"},ticks:{precision:0,stepSize:Math.max(1,Math.ceil($/4))}}}}}),()=>{u.current&&(u.current.destroy(),u.current=null)}},[s,C,n,$]);const W=()=>{K({pagePath:m,pageUuid:x,timeRangeKey:r}),E("loading"),b(null),w(null),O(i=>i+1),y(!0)};return!j||!v?null:a.jsxs("div",{className:c.container,children:[a.jsxs("div",{className:c.headerRow,role:"button",tabIndex:0,"aria-expanded":s,"aria-label":n(s?"toggleHide":"toggleShow"),onClick:()=>y(i=>!i),onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),y(p=>!p))},style:{cursor:"pointer"},children:[a.jsx("span",{className:`${c.chevron} ${s?c.chevronExpanded:""}`}),a.jsx("div",{className:c.title,children:n("title")}),a.jsx("div",{className:c.headerSpacer}),s&&a.jsxs(a.Fragment,{children:[a.jsx("div",{onClick:i=>i.stopPropagation(),children:a.jsxs("select",{className:c.rangeSelect,value:r,"aria-label":n("rangeLabel"),onChange:i=>{const p=i.target.value;o(p),K({pagePath:m,pageUuid:x,timeRangeKey:r}),O(L=>L+1)},children:[a.jsx("option",{value:"last6Months",children:n("rangeLast6Months")}),a.jsx("option",{value:"last3Months",children:n("rangeLast3Months")}),a.jsx("option",{value:"lastMonth",children:n("rangeLastMonth")}),a.jsx("option",{value:"lastWeek",children:n("rangeLastWeek")}),a.jsx("option",{value:"today",children:n("rangeToday")})]})}),a.jsxs("button",{type:"button",className:`${c.actionButton} ${c.refreshButton}`,onClick:i=>{i.stopPropagation(),K({pagePath:m,pageUuid:x,timeRangeKey:r}),O(p=>p+1)},children:[a.jsx("span",{className:c.buttonIcon,"aria-hidden":"true",children:a.jsx(Ke,{})}),a.jsx("span",{children:n("refresh")})]}),a.jsx(a.Fragment,{children:a.jsxs("button",{type:"button",className:`${c.actionButton} ${c.dashboardButton}`,disabled:!P,onClick:i=>{i.stopPropagation(),console.log("Dashboard button clicked, URL:",P),P&&window.open(P,"_blank","noopener,noreferrer")},children:[a.jsx("span",{className:c.buttonIcon,"aria-hidden":"true",children:a.jsx(Ze,{})}),a.jsx("span",{children:n("pageDashboard")})]})})]})]}),s&&a.jsxs("div",{className:c.body,children:[!v&&a.jsx("div",{className:c.stateText,children:n("empty")}),v&&T==="loading"&&a.jsx("div",{className:c.stateText,children:n("loading")}),v&&T==="error"&&a.jsxs("div",{children:[a.jsx("div",{className:c.stateText,children:n("error")}),a.jsx("button",{type:"button",className:c.retry,onClick:W,children:n("retry")})]}),v&&T==="success"&&!J&&a.jsx("div",{className:c.stateText,children:n("empty")}),v&&T==="success"&&J&&a.jsxs("div",{children:[a.jsxs("div",{className:c.cardGrid,children:[a.jsxs("div",{className:c.card,children:[a.jsx("div",{className:c.cardLabel,children:n("allVisits")}),a.jsx("div",{className:c.cardValue,children:F(R?.allVisits)})]}),a.jsxs("div",{className:c.card,children:[a.jsxs("div",{className:c.cardLabel,children:[n("uniqueSessions")," (",G(r,n),")"]}),a.jsx("div",{className:c.cardValue,children:F(R?.uniqueSessions)})]}),a.jsxs("div",{className:c.card,children:[a.jsxs("div",{className:c.cardLabel,children:[n("uniqueVisitors")," (",G(r,n),")"]}),a.jsx("div",{className:c.cardValue,children:F(R?.uniqueVisitors)})]}),a.jsxs("div",{className:c.card,children:[a.jsxs("div",{className:c.cardLabel,children:[n("visits")," (",G(r,n),")"]}),a.jsx("div",{className:c.cardValue,children:F(R?.visitsInRange)})]}),a.jsxs("div",{className:c.card,children:[a.jsxs("div",{className:c.cardLabel,children:[n("directEntries")," (",G(r,n),")"]}),a.jsx("div",{className:c.cardValue,children:F(R?.directEntries)})]})]}),a.jsx("div",{className:c.sectionTitle,children:n("viewsOverTime")}),C.length>0?a.jsx("div",{className:c.chart,children:a.jsx("canvas",{ref:q,className:c.chartCanvas})}):a.jsx("div",{className:c.stateText,children:n("empty")})]})]})]})},At=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"}));export{Bt as a,At as p,Dt as s};
//# sourceMappingURL=pageInsightsBlock-nwk85iR4.js.map
